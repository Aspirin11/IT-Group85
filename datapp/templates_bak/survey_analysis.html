{% extends 'base.html' %}

{% block content %}
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Survey Analysis Dashboard</h1>
</div>

<!-- Content Row -->
<!--<div class="row">-->
<!--    &lt;!&ndash; Total Surveys Card &ndash;&gt;-->
<!--    <div class="col-xl-4 col-md-6 mb-4">-->
<!--        <div class="card border-left-primary shadow h-100 py-2">-->
<!--            <div class="card-body">-->
<!--                <div class="row no-gutters align-items-center">-->
<!--                    <div class="col mr-2">-->
<!--                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">-->
<!--                            Total Surveys</div>-->
<!--                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_surveys }}</div>-->
<!--                    </div>-->
<!--                    <div class="col-auto">-->
<!--                        <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->

<!--    &lt;!&ndash; Total Responses Card &ndash;&gt;-->
<!--    <div class="col-xl-4 col-md-6 mb-4">-->
<!--        <div class="card border-left-success shadow h-100 py-2">-->
<!--            <div class="card-body">-->
<!--                <div class="row no-gutters align-items-center">-->
<!--                    <div class="col mr-2">-->
<!--                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">-->
<!--                            Total Responses</div>-->
<!--                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_responses }}</div>-->
<!--                    </div>-->
<!--                    <div class="col-auto">-->
<!--                        <i class="fas fa-comments fa-2x text-gray-300"></i>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->

<!--    &lt;!&ndash; Average Responses Card &ndash;&gt;-->
<!--    <div class="col-xl-4 col-md-6 mb-4">-->
<!--        <div class="card border-left-info shadow h-100 py-2">-->
<!--            <div class="card-body">-->
<!--                <div class="row no-gutters align-items-center">-->
<!--                    <div class="col mr-2">-->
<!--                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">-->
<!--                            Avg. Responses Per Survey</div>-->
<!--                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ avg_responses_per_survey }}</div>-->
<!--                    </div>-->
<!--                    <div class="col-auto">-->
<!--                        <i class="fas fa-chart-line fa-2x text-gray-300"></i>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<!-- Content Row -->
<div class="row">
    <!-- Survey Response Chart -->
    <div class="col-xl-8 col-lg-7">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Survey Response Distribution</h6>
            </div>
            <div class="card-body">
                <div id="surveyResponseChart" style="width: 100%; height: 400px;"></div>
            </div>
        </div>
    </div>

    <!-- Question Type Distribution -->
    <div class="col-xl-4 col-lg-5">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Question Type Distribution</h6>
            </div>
            <div class="card-body">
                <div id="questionTypeChart" style="width: 100%; height: 400px;"></div>
            </div>
        </div>
    </div>
</div>

<!--&lt;!&ndash; Recent Responses &ndash;&gt;-->
<!--<div class="row">-->
<!--    <div class="col-12">-->
<!--        <div class="card shadow mb-4">-->
<!--            <div class="card-header py-3">-->
<!--                <h6 class="m-0 font-weight-bold text-primary">Recent Responses</h6>-->
<!--            </div>-->
<!--            <div class="card-body">-->
<!--                <div class="table-responsive">-->
<!--                    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">-->
<!--                        <thead>-->
<!--                            <tr>-->
<!--                                <th>Survey</th>-->
<!--                                <th>User</th>-->
<!--                                <th>Submission Date</th>-->
<!--                            </tr>-->
<!--                        </thead>-->
<!--                        <tbody>-->
<!--                            {% for response in recent_responses %}-->
<!--                            <tr>-->
<!--                                <td>{{ response.survey.title }}</td>-->
<!--                                <td>{{ response.user.name|default:"Anonymous" }}</td>-->
<!--                                <td>{{ response.datesubmitted }}</td>-->
<!--                            </tr>-->
<!--                            {% endfor %}-->
<!--                        </tbody>-->
<!--                    </table>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<!-- Include Echarts -->
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
<script>
    // Survey Response Chart
    var surveyChart = echarts.init(document.getElementById('surveyResponseChart'));
    var surveyOption = {
        tooltip: {
            trigger: 'axis',
            axisPointer: {
                type: 'shadow'
            }
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        xAxis: {
            type: 'category',
            data: [{% for survey in survey_data %}'{{ survey.title }}'{% if not forloop.last %}, {% endif %}{% endfor %}],
            axisLabel: {
                interval: 0,
                rotate: 30
            }
        },
        yAxis: {
            type: 'value',
            name: 'Responses'
        },
        series: [{
            name: 'Responses',
            type: 'bar',
            data: [{% for survey in survey_data %}{{ survey.response_count }}{% if not forloop.last %}, {% endif %}{% endfor %}],
            itemStyle: {
                color: '#4e73df'
            }
        }]
    };
    surveyChart.setOption(surveyOption);

    // Question Type Chart
    var questionChart = echarts.init(document.getElementById('questionTypeChart'));
    var questionOption = {
        tooltip: {
            trigger: 'item',
            formatter: '{a} <br/>{b}: {c} ({d}%)'
        },
        legend: {
            orient: 'vertical',
            left: 10,
            data: [{% for item in question_type_data %}'{{ item.type }}'{% if not forloop.last %}, {% endif %}{% endfor %}]
        },
        series: [{
            name: 'Question Types',
            type: 'pie',
            radius: ['50%', '70%'],
            avoidLabelOverlap: false,
            label: {
                show: false,
                position: 'center'
            },
            emphasis: {
                label: {
                    show: true,
                    fontSize: '16',
                    fontWeight: 'bold'
                }
            },
            labelLine: {
                show: false
            },
            data: [
                {% for item in question_type_data %}
                {
                    value: {{ item.count }},
                    name: '{{ item.type }}'
                }{% if not forloop.last %}, {% endif %}
                {% endfor %}
            ]
        }]
    };
    questionChart.setOption(questionOption);

    // Resize charts when window is resized
    window.addEventListener('resize', function() {
        surveyChart.resize();
        questionChart.resize();
    });
</script>
{% endblock %}
